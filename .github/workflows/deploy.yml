name: Deploy GlyphMind AI (DISABLED - Use Render.com Direct Integration)

# Disabled workflow - Deploy directly through Render.com GitHub integration
# See RENDER_SETUP_GUIDE.md for setup instructions

on:
  # Disabled - uncomment to re-enable
  # push:
  #   branches: [ main ]
  # workflow_dispatch:

jobs:
  deploy-backend:
    name: Deploy Backend to Render
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Trigger Render Deploy
        env:
          RENDER_SERVICE_ID: ${{ secrets.RENDER_SERVICE_ID }}
          RENDER_API_KEY: ${{ secrets.RENDER_API_KEY }}
        run: |
          curl -X POST \
            "https://api.render.com/v1/services/$RENDER_SERVICE_ID/deploys" \
            -H "Authorization: Bearer $RENDER_API_KEY" \
            -H "Content-Type: application/json" \
            -d '{"clearCache": false}'

  deploy-frontend:
    name: Deploy Frontend to Hugging Face Spaces
    runs-on: ubuntu-latest
    needs: deploy-backend
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Setup Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.10'

      - name: Install Hugging Face Hub
        run: |
          pip install huggingface_hub

      - name: Deploy to Hugging Face Spaces
        env:
          HF_TOKEN: ${{ secrets.HF_TOKEN }}
          HF_USERNAME: ${{ secrets.HF_USERNAME }}
          HF_SPACE_NAME: ${{ secrets.HF_SPACE_NAME }}
          BACKEND_URL: ${{ secrets.BACKEND_URL }}
        run: |
          cd frontend
          
          # Create .env file with backend URL
          echo "BACKEND_URL=$BACKEND_URL" > .env
          
          # Login to Hugging Face
          python -c "
          from huggingface_hub import HfApi, login
          import os
          
          login(token=os.environ['HF_TOKEN'])
          api = HfApi()
          
          # Upload files to Hugging Face Spaces
          api.upload_folder(
              folder_path='.',
              repo_id=f\"{os.environ['HF_USERNAME']}/{os.environ['HF_SPACE_NAME']}\",
              repo_type='space',
              commit_message='Auto-deploy from GitHub Actions'
          )
          "

  notify:
    name: Notify Deployment Status
    runs-on: ubuntu-latest
    needs: [deploy-backend, deploy-frontend]
    if: always()
    steps:
      - name: Deployment Success
        if: needs.deploy-backend.result == 'success' && needs.deploy-frontend.result == 'success'
        run: |
          echo "✅ Both backend and frontend deployed successfully!"
          echo "Backend: Render.com"
          echo "Frontend: Hugging Face Spaces"

      - name: Deployment Failed
        if: needs.deploy-backend.result == 'failure' || needs.deploy-frontend.result == 'failure'
        run: |
          echo "❌ Deployment failed!"
          echo "Backend status: ${{ needs.deploy-backend.result }}"
          echo "Frontend status: ${{ needs.deploy-frontend.result }}"
