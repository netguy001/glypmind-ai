name: Deploy to Render.com

on:
  push:
    branches: [ main ]
    paths: 
      - 'backend/**'
  workflow_dispatch:

jobs:
  notify-render:
    name: Notify Render of Changes
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
        
      - name: Notify Render Deploy (Optional)
        run: |
          echo "ğŸš€ Backend changes detected in commit ${{ github.sha }}"
          echo "ğŸ“ Files changed in backend/ directory"
          echo "ğŸ”„ Render will automatically deploy if connected to this repository"
          echo "ğŸ’¡ If auto-deploy is disabled, manually trigger deploy in Render dashboard"
          
      - name: Validate Backend Structure
        run: |
          echo "ğŸ” Validating backend structure..."
          
          # Check required files exist
          if [ ! -f "backend/requirements-minimal.txt" ]; then
            echo "âŒ Missing backend/requirements-minimal.txt"
            exit 1
          fi
          
          if [ ! -f "backend/render_start.py" ]; then
            echo "âŒ Missing backend/render_start.py"
            exit 1
          fi
          
          if [ ! -f "backend/Procfile" ]; then
            echo "âŒ Missing backend/Procfile"
            exit 1
          fi
          
          if [ ! -f "backend/.python-version" ]; then
            echo "âŒ Missing backend/.python-version"
            exit 1
          fi
          
          echo "âœ… All required files present"
          echo "âœ… Backend structure is valid for Render deployment"
